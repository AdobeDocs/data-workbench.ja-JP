---
description: Microsoft Windows Server 2000 以降で動作するインターネットインフォメーションサービス (IIS)5.x または 6.x のセンサーのインストールおよび設定方法について説明します。
title: Microsoft IIS（Windows Server 2000 以降）
uuid: 26da0638-82c8-424f-9f00-aab3a940e5a9
exl-id: e4b5ac44-b0ac-43be-9b9c-180a64354081
source-git-commit: b1dda69a606a16dccca30d2a74c7e63dbd27936c
workflow-type: tm+mt
source-wordcount: '1718'
ht-degree: 1%

---

# Microsoft IIS（Windows Server 2000 以降）{#microsoft-iis-on-windows-server-or-later}

{{eol}}

Microsoft Windows Server 2000 以降で動作するインターネットインフォメーションサービス (IIS)5.x または 6.x のセンサーのインストールおよび設定方法について説明します。

IIS 6.x を使用する場合、Sensor が正しく機能するには、ログを有効にする必要があります。 ディスク I/O を減らすためにログを無効にした場合、ログにデータを書き込むことなくログを有効にできます。 これを行うには、ログを有効にし、W3C 拡張ログファイル形式のプロパティの「詳細」タブですべてのフィールドをクリアします。 サポートが必要な場合は、Adobeコンサルティングサービスにお問い合わせください。

Sensor のプログラムファイルは、インストールファイルにパッケージ化され、Adobeダウンロードサイトから入手できます。 ご使用の Web サーバー用の Sensor インストールファイルがまだない場合は、次の手順を開始する前に、そのファイルをダウンロード ( またはAdobe担当者から入手 ) してください。

Sensor をインストールして設定するには、次の大まかな手順を実行する必要があります。

## 1.プログラムファイルをインストールする {#section-9ef8c4e38c244b7d8b6d4bc6c0ad53fd}

Windows IIS で Sensor を実行する場合、プログラムファイルとディスクキューファイルは同じディレクトリに存在する必要があります。

したがって、プログラムファイルをインストールする前に、ディスクキューを保持する場所を決定する必要があります。これは、プログラムファイルをインストールする場所でもあるからです。

次の手順を実行して、Sensor 用のプログラムファイルを抽出し、インストールします。

1. Windows マシン上に、Sensor プログラムファイルをインストールするディレクトリを作成します。 ディスクキューもこのディレクトリに存在するので、選択したデバイスに必要なサイズのキューを保持するのに十分な空き容量があることを確認してください。

   例：C:\VisualSensor

1. 作成したディレクトリに、インストールファイルの内容を抽出します。 この手順の間、Sensor は以下のファイルをインストールします。

<table id="table_C9E8803E51D046FD8FCCA38F8DAC04D1">
 <thead>
  <tr>
   <th colname="col1" class="entry"> ファイル </th>
   <th colname="col2" class="entry"> 説明 </th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td colname="col1"> EventMessages.dll </td>
   <td colname="col2"> イベントビューアメッセージ </td>
  </tr>
  <tr>
   <td colname="col1"> qlog.dll </td>
   <td colname="col2"> コレクタモジュール（ISAPI フィルタ）。 </td>
  </tr>
  <tr>
   <td colname="col1"> TestExperiment.xls </td>
   <td colname="col2"> <p>アーキテクトが対照実験の設定に使用できる Excel スプレッドシートファイル。 </p> <p>センサーはこのファイルを使用しません。 </p> </td>
  </tr>
  <tr>
   <td colname="col1"> trust_ca_cert.pem </td>
   <td colname="col2"> 接続プロセス中に Insight サーバーが提示する電子証明書を検証するために使用される証明書です。 </td>
  </tr>
  <tr>
   <td colname="col1"> TXLog.exe </td>
   <td colname="col2"> トランスミッタープログラム。 </td>
  </tr>
  <tr>
   <td colname="col1"> txlogd.conf </td>
   <td colname="col2"> Sensor 設定ファイル。 </td>
  </tr>
 </tbody>
</table>

>[!NOTE]
>
>インストールパッケージには、TestExperiment.xls という名前のスプレッドシートファイルが含まれています。 このスプレッドシートは、アーキテクトが対照実験の設定に使用するツールです。 センサー自体はこのファイルを使用しないので、Sensor が実行されているマシンにファイルをインストールする必要はありません（ただし、インストールすることは可能です）。 代わりに、アーキテクトがアクセスできる場所にファイルをコピーするか、必要に応じてインストールパッケージからファイルを抽出します。 対照実験の詳細については、『 Insight 対照実験ガイド』を参照してください。

## 2.設定ファイルを編集します。 {#section-206daf855e664f16af9a96a5cd3e62b1}

txlogd.conf ファイルには、Sensor の設定パラメーターが含まれています。

ファイルを編集して、ディスクキューのサイズ、Insight サーバーのアドレス、このセンサーによって生成されるデータに添付される ID を指定する必要があります。 設定ファイルには、必須のパラメーターとオプションのパラメーターが含まれています。

* **必須パラメーター** は、Sensor をインストールする際に指定する必要がある設定です。 これらの設定がないと、センサーは正常に動作しません。
* **オプションのパラメーター** は、事前定義済みの値（変更可能）をデフォルトにする設定またはオプション機能を有効にする設定です。

**Sensor 設定ファイルを編集するには**

1. を開きます。 `<SensorDirectory>/txlogd.conf` ファイルを編集し、必要なパラメーターと必要なオプションパラメーターを設定します。

   txlogd.conf パラメーターの説明については、センサーの txlogd.conf ファイルのパラメーターを参照してください。

   完成した設定ファイルの例については、 Sensor Sample Configuration Files を参照してください。

1. ファイルを保存して閉じます。

## 3.トランスミッターを起動し、ディスクキューを作成します {#section-a0af390ee1954109bcff5d9f09798683}

txlogd.conf ファイルを設定した後、トランスミッタープログラムを起動し、Windows サービスとして登録し、ディスクキューを作成できます。

1. Windows の [ スタート ] メニューから、[ アクセサリ ] > [ コマンドプロンプト ] を選択します。
1. コマンドプロンプトウィンドウで、Sensor をインストールしたディレクトリに移動し、次のコマンドを実行します。

   ```
   txlog /regserver
   ```

   このコマンドは、トランスミッターを起動し、ディスクキューを作成し、Sensor を Windows サービスとして登録します。

1. トランスミッターが正しく実行されていることを確認するには、スタート/Campaign コントロールパネル/管理ツール/サービスをクリックします。

   >[!NOTE]
   >
   >このコマンドの順序は、使用している Windows のバージョンによって異なる場合があります。

   1. サービスリストで、Sensor のエントリを探し、そのステータスが「開始済み」で、起動タイプが「自動」であることを確認します。
   1. [ サービス ] コントロールパネルを閉じます。

1. 起動中にトランスミッターでエラーが発生したかどうかを確認するには、スタート/Campaign コントロールパネル/管理ツール/イベントビューアをクリックして、イベントビューアを開きます。

   >[!NOTE]
   >
   >このコマンドの順序は、使用している Windows のバージョンによって異なる場合があります。

   1. [Event Viewer] ウィンドウの左ペインで、[Applications] ログを選択します。
   1. 右側のウィンドウで、「ソース」列に「Adobe」があるイベントを探します。
   1. 「Adobe」からエラーが見つかった場合は、そのエラーをダブルクリックして「イベントのプロパティ」ウィンドウを表示します。 このウィンドウには、エラーに関する詳細情報が表示されます。

1. アプリケーションログの調査が終了したら、イベントビューアを閉じます。
1. トランスミッターが Sensor プログラムファイルをインストールしたディレクトリにディスクキュー (Diskq2000.log) を作成し、txlogd.conf ファイルの QueueSize パラメーターで指定したサイズであることを確認します。

   キューが正しく作成されていない場合：

   1. txtlogd.conf ファイルを調べ、QueueSize パラメーターが正しく設定されていることを確認します。
   1. Sensor をインストールしたデバイスに、QueueSize パラメータで指定したサイズのファイルを保持するのに十分な空き容量があることを確認します。
   1. Windows のサービスコントロールパネルで、トランスミッターを停止します。
   1. キューファイルを削除します。
   1. センサーを Windows サービスとして再登録：Windows の [ スタート ] メニューから、[ アクセサリ ] > [ コマンドプロンプト ] を選択します。 コマンドプロンプトウィンドウで、Sensor をインストールしたディレクトリに移動し、次のコマンドを実行します。

      ```
      txlog /regserver
      ```

トランスミッターは、連続的に実行するように設計されています。 コンピューターを再起動すると、トランスミッターが自動的に再起動します。 トランスミッターを手動で起動および停止する必要がある場合は、Windows の [ サービス ] コントロールパネルを使用して実行できます。

## Web サーバーにコレクタを追加する {#section-682dc480e5574791ac18da104daf7906}

IIS の場合、コレクターは IIS の Web サーバーに追加する ISAPI フィルターです。

1. スタート/管理ツール/インターネットインフォメーションサービス (IIS) マネージャーを使用して、IIS マネージャーを開きます。
1. [ ローカルコンピュータ ] ノードと [Web サイト ] ノードを展開します。
1. コレクターを追加する Web サイトを右クリックし、「プロパティ」を選択します。
1. 「 ISAPI フィルター」タブを選択し、「追加」をクリックします。
1. 「フィルタ名」フィールドに、フィルタの表示名を入力します。 推奨されるフィルター名は「Sensor」です。
1. [ 参照 ] をクリックし、Sensor をインストールしたディレクトリにある qlog.dll ファイルを選択して、[OK] をクリックします。
1. 「 OK 」をクリックして、フィルターを追加します。

   フィルターを追加すると、コレクターが直ちに動作し、データを収集する準備が整います。 IIS マネージャの「ISAPI フィルタ」タブの「ステータス」列に、上向きの緑色の矢印が表示されます。 トラフィックが実際にフィルターを通過するまで、緑色の矢印は表示されない場合があります。 この場合、Web サーバーにリクエストを送信して、コレクターが正しく動作していることを確認する必要があります。

コレクターにトラフィックが流れた後に緑色の矢印が表示されない場合は、次の手順に従います。

1. スタート/管理ツール/イベントビューアをクリックして、イベントビューアでエラーを確認します。

   >[!NOTE]
   >
   >このコマンドの順序は、使用している Windows のバージョンによって異なる場合があります。

1. [Event Viewer] ウィンドウの左ペインで、[Application] ログを選択します。
1. 右側のウィンドウで、「ソース」列に「Adobe」があるイベントを探します。
1. エラーが見つかった場合は、エラーをダブルクリックして「イベントのプロパティ」ウィンドウを表示します。

## 追加データのキャプチャ {#section-dcd10073eb1947a5928e4f9b9fa99e3a}

Web ページは、多くの場合、ASP(Active Server Pages) プログラミング言語を使用して構造化されます。

ASP は、IIS 内で動作するMicrosoftテクノロジーです。 ブラウザが ASP ファイルを要求すると、IIS はその要求を ASP エンジンに渡します。 ASP エンジンは、ASP ファイルを 1 行ずつ読み取り、ファイル内のスクリプトを実行します。 最後に、ASP ファイルがプレーンHTMLとしてブラウザに返されます。 ASP は、RESPOND または REQUEST オブジェクトを提供し、他の利用方法に加えて、HTML・フォームから送信されたユーザー・クエリやデータの応答やリクエストを許可します。

場合によっては、ユーザーのブラウザーのアドレスバー内に表示される URL や、HTMLコード自体に表示可能な URL に、フォームに入力された値を追加したくないことがあります。 簡単なサーバー側 ASP スクリプトを使用すると、フォームフィールド名とそれぞれの値を、ユーザーのブラウザー内で使用したり、HTMLファイルに埋め込んだりしなくても、ログファイルに追加できます。 Web サイト内の特定のフォームに入力された実際のフォーム値を取り込むには、数行のコードを追加して、フォーム値をログリクエストに追加する必要があります。

フォームの処理ページ内で、次のコードを追加して、入力したフォームの値を（送信したフォームの値を外部データベースやその他の場所に書き込むのに加えて）要求データに追加します。

```
var sName= Request.Form("Name");
var sCity= Request.Form("City");
var sState= Request.Form("State");
var sZip= Request.Form("Zip");

Response.AppendToLog("&v_1=" +  sName);
Response.AppendToLog("&v_2=" +  sCity);
Response.AppendToLog("&v_3=" +  sState);
Response.AppendToLog("&v_4=" +  sZip);
```

このプロセスは、フォーム処理ページのリクエストデータに定義されたとおりのフォーム値を追加します。 ログデータ内では、追加された値がフォーム処理ページのクエリ文字列として使用できます（下図を参照）。 例えば、v_1、v_2、v_3 および v_4 は、適切なフォームフィールドに入力されたデータを含むクエリ文字列になります。 前の例で説明した構文は、取り込む追加のフォームフィールドおよび値に対して複製できます。

```
https://www.myserver.com/path/to/formprocessingpage.asp?v_1=John+Smith&v_2=Los+Angeles&v_3=California&v_4=90210
```

すべてのフォームフィールドと値を取り込んで分析に使用する場合は、次の構文を使用できます。

```
var formvalues = Response.Form;
Response.AppendToLog(formvalues);
```

次の例では、HTML内に存在するすべてのフォームフィールドとそれぞれの値を取り込み、クエリ文字列としてフォーム処理ページのログエントリに追加します。 これには、フォーム内に存在する非表示のフィールドが含まれます。

ログデータは、次の表で詳しく説明するように拡張されます。

| 収集されたデータ | 説明 | 例 |
|---|---|---|
| v_1 | NAME クエリ文字列に関連付けられた値 | v_1=John Smith |
| v_2 | CITY クエリ文字列に関連付けられた値 | v_2=ロサンゼルス |
| v_3 | STATE クエリ文字列に関連付けられた値 | v_3=カリフォルニア |
| v_4 | ZIP クエリ文字列に関連付けられた値 | v_4=90210 |
